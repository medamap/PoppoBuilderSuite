# 要件定義書

## 概要
このドキュメントは、顧客要求（customer-demands.md）を基に、技術的実現可能性を検討し、実装可能な要件として定義したものです。

**作成日**: 2025/6/15
**ブランチ**: feature/requirements-definition-framework
**ステータス**: 要件定義中

## 要件一覧

### 1. テストファースト開発
**要求**: テストファーストで開発し、仕様変更時はテストが先に更新される
**実現可能性**: ✅ 可能
**要件定義**:
- すべての新機能開発はテスト作成から開始する
- 仕様変更時は、まずテストを更新してから実装を変更する
- テストが通ることが実装完了の定義とする
- 各フェーズ（要件定義、設計、実装）でテストケースを定義・更新する

### 2. GitHub Issue駆動開発
**要求**: 開発フローは「要求定義」→「要件定義」→「概要設計」→「詳細設計」→「実装」→「テスト」→「PR作成」
**実現可能性**: ✅ 可能
**要件定義**:
- GitHub Issueを開発の起点とする
- 各フェーズをIssueのラベルで管理（phase:requirements, phase:design等）
- フェーズ移行時にIssueを自動更新
- 各フェーズの成果物をIssueコメントに記録
- `gh` CLIツールを使用してIssue操作を自動化

### 3. バイリンガルドキュメント
**要求**: 日本語メイン、英語版も同時更新
**実現可能性**: ⚠️ 部分的に可能
**要件定義**:
- 日本語版を主ドキュメントとして管理
- 重要なドキュメントは手動で英語版を作成・更新
- 自動翻訳は品質の問題があるため、当面は手動更新
- ドキュメント更新時のチェックリストに英語版更新を含める

### 4. Git/GitHub機能の明確化
**要求**: GitとGitHub独自機能の一覧表
**実現可能性**: ✅ 可能
**要件定義**:
- Git標準機能とGitHub独自機能の対照表をドキュメント化
- 開発フローでGitHub依存部分を明確化
- 将来的な他プラットフォーム対応のための抽象化層を検討

### 5. クロスプラットフォーム対応
**要求**: Windows/Linux/Mac対応
**実現可能性**: ✅ 可能
**要件定義**:
- Node.jsベースで実装（クロスプラットフォーム対応）
- OS固有のパス区切り文字は抽象化
- シェルスクリプトは避け、Node.jsスクリプトを使用
- プロセス管理はNode.jsのchild_processモジュールを使用

### 6. 双方向コミュニケーション（問題解決フロー）
**要求**: 問題発生時にPoppoBuilderがIssueを作成、ユーザー回答待ち
**実現可能性**: ✅ 可能
**要件定義**:
- エラーや不明点発生時に自動でIssueを作成
- Issueテンプレートを用意（問題内容、必要な情報、選択肢等）
- Issue番号をタスクに紐付けて管理
- 回答待ちタスクはpending状態で管理
- 他のタスクは並行実行可能

### 7. Issue中心のコミュニケーション
**要求**: 初回初期化以外はすべてIssue経由
**実現可能性**: ✅ 可能
**要件定義**:
- プロジェクト初期化コマンドのみCLI経由
- 以降のすべての指示はGitHub Issue経由
- Issue番号でタスクを追跡
- Issueクローズでタスク完了

### 8. 進捗・ステータスの可視化
**要求**: GitHub経由で進捗確認、Wiki活用
**実現可能性**: ✅ 可能
**要件定義**:
- GitHub ProjectsまたはIssueラベルで進捗管理
- 定期的にWikiに進捗サマリーを自動更新
- Wikiはgitプロトコルで更新可能
- ステータスダッシュボードページをWikiに作成

### 9. 優先実装機能
**要求**: Issue通信とプロセススポーンを最初に実装
**実現可能性**: ✅ 可能
**要件定義**:
- Phase 1: GitHub Issue読み書き機能
- Phase 2: Claude CLIプロセススポーン機能
- Phase 3: 基本的なタスク実行フロー
- Phase 4: セルフホスティング対応

### 10. ブランチ戦略と作業の可視化
**要求**: 適切なブランチ管理で作業状態を明確化、PoppoBuilderが自律的に判断
**実現可能性**: ✅ 可能
**要件定義**:
- Git Flow戦略を採用
  - `main`: 本番リリース版
  - `develop`: 開発統合ブランチ
  - `feature/*`: 機能開発
  - `fix/*`: バグ修正
  - `docs/*`: ドキュメント更新
  - `hotfix/*`: 緊急修正
- ブランチ名は作業内容を明確に表現（例: feature/issue-communication）
- PoppoBuilderが以下を自律的に判断・実行：
  - Issueの内容からブランチ種別を判定
  - 適切なブランチ名を生成
  - ブランチの作成・切り替え
  - PR作成時の適切なベースブランチ選択
  - マージ戦略の決定（fast-forward、squash、通常マージ）
- ユーザーがIssueで明示的に指示した場合はそれに従う

### 11. 開発プロセスの厳守
**要求**: トップダウンで全フェーズを必ず実行
**実現可能性**: ✅ 可能
**要件定義**:
- Issueを受信したら以下のフェーズを順番に実行：
  1. **要求定義フェーズ**
     - Issueから要求を抽出
     - 要求の明確化が必要な場合は質問Issue作成
  2. **要件定義フェーズ**
     - 技術的実現可能性の検討
     - 実装可能な要件として定義
  3. **概要設計フェーズ**
     - システム全体の設計
     - コンポーネント間の関係定義
  4. **詳細設計フェーズ**
     - 各コンポーネントの詳細設計
     - API仕様、データ構造の定義
  5. **実装フェーズ**
     - テストコード作成（TDD）
     - 本体コード実装
  6. **テストフェーズ**
     - 単体テスト実行
     - 統合テスト実行
  7. **PR作成フェーズ**
     - コードレビュー用PR作成
     - ドキュメント更新
- 各フェーズの成果物：
  - Issueコメントに記録
  - 専用ドキュメントファイル作成
  - フェーズ完了時にラベル更新
- フェーズのスキップは禁止
- 前フェーズ未完了の場合は次フェーズに進まない

### 12. フェーズ実行の制御
**要求**: ユーザー指示によるフェーズの一時停止機能
**実現可能性**: ✅ 可能
**要件定義**:
- ユーザーがIssueで実行範囲を制限可能
- 制御方法：
  - Issue本文に「〇〇フェーズまで実行」と記載
  - 例：「要件定義フェーズまで実行」
  - 例：「設計フェーズまで実行して承認待ち」
- 動作仕様：
  - 指定されたフェーズまで実行して自動停止
  - 停止時に承認待ちIssueを自動作成
  - Issueに「phase:waiting-approval」ラベルを付与
  - ユーザーが承認コメントをしたら次フェーズ開始
- デフォルト動作：
  - 指定がない場合は全フェーズを連続実行
  - 重要な変更の場合は設計フェーズ後に確認を推奨

## 技術スタック
- **言語**: Node.js (JavaScript/TypeScript)
- **プロセス管理**: child_process
- **GitHub連携**: gh CLI
- **設定管理**: JSON
- **テストフレームワーク**: Jest
- **CI/CD**: 初期はローカル実行、将来的にGitHub Actions対応

## 制約事項
1. Claude CLIの`--dangerously-skip-permissions`フラグが必要
2. GitHub APIレート制限への配慮が必要
3. 長時間実行タスクのタイムアウト管理が必要
4. プロセス数の上限管理が必要

## 次のステップ
1. 概要設計書の作成
2. 優先実装機能の詳細設計
3. テストケースの定義