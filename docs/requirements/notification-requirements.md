# スマホ通知機能 要求定義書

## 1. 概要

PoppoBuilderにIssue処理完了時のスマホ通知機能を追加する。利用者が外出先でもIssue処理の完了を把握できるようにすることで、リモートワークの利便性を向上させる。

## 2. 背景と目的

### 背景
- 外出中に外からIssueを登録することが多い
- 処理完了を確認するためにGitHubを都度確認する必要がある
- デスクトップ通知はローカルマシンでしか受信できない

### 目的
- Issue処理完了をリアルタイムでスマホに通知
- 複数の通知方式から利用者が選択可能
- 既存システムへの影響を最小限に抑えた実装

## 3. 機能要求

### 3.1 通知タイミング
- R-NOTIF-001: Issue処理が正常に完了した時点で通知を送信すること
- R-NOTIF-002: エラー終了時にもエラー通知を送信できること（オプション）
- R-NOTIF-003: dogfoodingタスク完了時の自動再起動も通知できること（オプション）

### 3.2 通知内容
- R-NOTIF-004: 最低限以下の情報を含むこと
  - Issue番号
  - Issueタイトル
  - 処理結果（成功/失敗）
  - 処理時間（オプション）
- R-NOTIF-005: 通知メッセージはカスタマイズ可能であること

### 3.3 通知方式
- R-NOTIF-006: Discord Webhook経由での通知をサポートすること
- R-NOTIF-007: Pushover API経由での通知をサポートすること
- R-NOTIF-008: Telegram Bot経由での通知をサポートすること
- R-NOTIF-009: 各通知方式は独立して有効/無効を設定できること
- R-NOTIF-010: 複数の通知方式を同時に利用できること

### 3.4 設定管理
- R-NOTIF-011: 通知設定は`.poppo/config.json`で管理すること
- R-NOTIF-012: 認証情報は環境変数で管理できること
- R-NOTIF-013: 通知設定のバリデーション機能を持つこと

## 4. 非機能要求

### 4.1 パフォーマンス
- R-NOTIF-014: 通知送信処理は非同期で実行し、Issue処理をブロックしないこと
- R-NOTIF-015: 通知送信のタイムアウトは5秒以内とすること

### 4.2 信頼性
- R-NOTIF-016: 通知送信失敗がIssue処理全体を失敗させないこと
- R-NOTIF-017: 通知送信失敗時はログに記録すること
- R-NOTIF-018: リトライ機能を持つこと（最大3回）

### 4.3 セキュリティ
- R-NOTIF-019: 認証トークンは平文で保存しないこと
- R-NOTIF-020: 通知内容に機密情報を含めないよう設定可能であること

### 4.4 拡張性
- R-NOTIF-021: 新しい通知方式を容易に追加できる設計とすること
- R-NOTIF-022: 通知プロバイダごとにモジュール化すること

## 5. 制約事項

- C-NOTIF-001: 既存のPoppoBuilderの動作に影響を与えないこと
- C-NOTIF-002: 各通知サービスの利用規約に準拠すること
- C-NOTIF-003: 無料で利用可能な方式を優先すること

## 6. 優先順位

実装優先順位：
1. Discord Webhook（最も簡単で無料）
2. Pushover（専用アプリで使いやすい）
3. Telegram Bot（高機能だが設定が複雑）

## 7. 用語定義

- **通知プロバイダ**: Discord、Pushover、Telegramなどの通知サービス
- **Webhook**: HTTPリクエストでデータを送信する仕組み
- **非同期処理**: メイン処理をブロックせずにバックグラウンドで実行

## 8. 参考情報

- Discord Webhook: https://discord.com/developers/docs/resources/webhook
- Pushover API: https://pushover.net/api
- Telegram Bot API: https://core.telegram.org/bots/api

---
作成日: 2025/06/16
作成者: PoppoBuilder Dogfooding Task