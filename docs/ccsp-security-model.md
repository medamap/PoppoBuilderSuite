# CCSPã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«

## ğŸ“‹ ç›®æ¬¡

1. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¦‚è¦](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¦‚è¦)
2. [è„…å¨ãƒ¢ãƒ‡ãƒ«](#è„…å¨ãƒ¢ãƒ‡ãƒ«)
3. [èªè¨¼ãƒ»èªå¯](#èªè¨¼ãƒ»èªå¯)
4. [ãƒ‡ãƒ¼ã‚¿ä¿è­·](#ãƒ‡ãƒ¼ã‚¿ä¿è­·)
5. [é€šä¿¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#é€šä¿¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
6. [ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡](#ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡)
7. [ç›£æŸ»ãƒ»ãƒ­ã‚°](#ç›£æŸ»ãƒ»ãƒ­ã‚°)
8. [ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ](#ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ)
9. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¦‚è¦

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆåŸå‰‡

CCSPã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ã¯ä»¥ä¸‹ã®åŸå‰‡ã«åŸºã¥ã„ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ï¼š

1. **å¤šå±¤é˜²å¾¡ï¼ˆDefense in Depthï¼‰**
   - è¤‡æ•°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ˆã‚‹ä¿è­·
   - å˜ä¸€éšœå®³ç‚¹ã®æ’é™¤

2. **æœ€å°æ¨©é™ã®åŸå‰‡ï¼ˆPrinciple of Least Privilegeï¼‰**
   - å¿…è¦æœ€å°é™ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
   - ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

3. **ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«**
   - ã™ã¹ã¦ã®é€šä¿¡ã‚’æ¤œè¨¼
   - å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚‚ä¿¡é ¼ã—ãªã„

4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ‡ã‚¶ã‚¤ãƒ³**
   - è¨­è¨ˆæ®µéšã‹ã‚‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è€ƒæ…®
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å®‰å…¨ãªè¨­å®š

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¢ƒç•Œ

```mermaid
graph TB
    subgraph "å¤–éƒ¨å¢ƒç•Œ"
        Internet[ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ]
        GitHub[GitHub API]
        Claude[Claude Code CLI]
    end
    
    subgraph "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¢ƒç•Œ"
        Dashboard[ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
        API[ç®¡ç†API]
    end
    
    subgraph "å†…éƒ¨å¢ƒç•Œ"
        CCSP[CCSP Agent]
        Redis[(Redis)]
        Agents[ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ]
    end
    
    subgraph "ã‚·ã‚¹ãƒ†ãƒ å¢ƒç•Œ"
        FS[ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ]
        Logs[ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«]
        Config[è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«]
    end
    
    Internet -.->|HTTPS| GitHub
    Internet -.->|HTTPS| Claude
    Internet -->|Basic Auth| Dashboard
    Dashboard -->|å†…éƒ¨API| API
    API -->|èªè¨¼æ¸ˆã¿| CCSP
    CCSP <-->|èªè¨¼| Redis
    CCSP <-->|ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°| Agents
    CCSP -->|åˆ¶é™ä»˜ã| FS
    CCSP -->|ãƒã‚¹ã‚­ãƒ³ã‚°| Logs
```

---

## è„…å¨ãƒ¢ãƒ‡ãƒ«

### 1. è„…å¨ã®åˆ†é¡

| è„…å¨ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | å½±éŸ¿åº¦ | å¯¾ç­–å„ªå…ˆåº¦ |
|-------------|------|--------|-----------|
| **èªè¨¼æƒ…å ±ã®æ¼æ´©** | APIã‚­ãƒ¼ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¸æ­£å–å¾— | Critical | High |
| **æ¨©é™æ˜‡æ ¼** | æ¨©é™å¤–ã®APIå‘¼ã³å‡ºã— | High | High |
| **ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦æ”»æ’ƒ** | å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã‚‹æ©Ÿèƒ½åœæ­¢ | Medium | Medium |
| **ãƒ‡ãƒ¼ã‚¿æ¼æ´©** | æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ | High | High |
| **ä¸­é–“è€…æ”»æ’ƒ** | é€šä¿¡ã®ç›—è´ãƒ»æ”¹ã–ã‚“ | Medium | Medium |
| **å†…éƒ¨è„…å¨** | å†…éƒ¨é–¢ä¿‚è€…ã«ã‚ˆã‚‹ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ | High | Medium |

### 2. æ”»æ’ƒã‚·ãƒŠãƒªã‚ªã¨å¯¾ç­–

#### ã‚·ãƒŠãƒªã‚ª1: GitHub Tokenæ¼æ´©
**æ”»æ’ƒ**: GitHubãƒˆãƒ¼ã‚¯ãƒ³ãŒç’°å¢ƒå¤‰æ•°ã‚„ãƒ­ã‚°ã‹ã‚‰æ¼æ´©
```
å¯¾ç­–:
âœ“ ç’°å¢ƒå¤‰æ•°ã®æš—å·åŒ–
âœ“ ãƒ­ã‚°ã®æ©Ÿå¯†æƒ…å ±ãƒã‚¹ã‚­ãƒ³ã‚°
âœ“ ãƒˆãƒ¼ã‚¯ãƒ³ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
âœ“ æœ€å°æ¨©é™ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®š
```

#### ã‚·ãƒŠãƒªã‚ª2: Redisä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹
**æ”»æ’ƒ**: Redisæ¥ç¶šæƒ…å ±ã‚’ä½¿ã£ãŸä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹
```
å¯¾ç­–:
âœ“ Redisèªè¨¼ã®æœ‰åŠ¹åŒ–
âœ“ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢
âœ“ æ¥ç¶šæš—å·åŒ–ï¼ˆRedis 6.0+ï¼‰
âœ“ IPã‚¢ãƒ‰ãƒ¬ã‚¹åˆ¶é™
```

#### ã‚·ãƒŠãƒªã‚ª3: å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ”»æ’ƒ
**æ”»æ’ƒ**: Claude APIã®å¤§é‡å‘¼ã³å‡ºã—ã«ã‚ˆã‚‹åˆ¶é™åˆ°é”
```
å¯¾ç­–:
âœ“ ãƒ¬ãƒ¼ãƒˆåˆ¶é™æ©Ÿèƒ½
âœ“ ç·Šæ€¥åœæ­¢æ©Ÿèƒ½
âœ“ ç•°å¸¸æ¤œçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
âœ“ IP/ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥åˆ¶é™
```

---

## èªè¨¼ãƒ»èªå¯

### 1. èªè¨¼æ–¹å¼

#### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èªè¨¼
```javascript
// Basicèªè¨¼ï¼ˆé–‹ç™ºãƒ»å†…éƒ¨åˆ©ç”¨ï¼‰
const basicAuth = {
  username: process.env.CCSP_ADMIN_USER || 'admin',
  password: process.env.CCSP_ADMIN_PASS || 'complex-password'
};

// JWTèªè¨¼ï¼ˆæœ¬æ ¼é‹ç”¨ï¼‰
const jwtAuth = {
  secret: process.env.JWT_SECRET,
  algorithm: 'HS256',
  expiresIn: '1h',
  issuer: 'ccsp-agent'
};
```

#### Redisèªè¨¼
```javascript
const redisConfig = {
  host: process.env.REDIS_HOST,
  port: process.env.REDIS_PORT,
  password: process.env.REDIS_PASSWORD, // å¿…é ˆ
  username: process.env.REDIS_USER,     // Redis 6.0+
  tls: process.env.REDIS_TLS === 'true' // æš—å·åŒ–æ¥ç¶š
};
```

### 2. èªå¯ãƒ¬ãƒ™ãƒ«

#### ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«å®šç¾©
```javascript
const ACCESS_LEVELS = {
  // èª­ã¿å–ã‚Šå°‚ç”¨
  READ_ONLY: {
    permissions: ['health:read', 'queue:read', 'stats:read'],
    endpoints: ['/api/ccsp/health', '/api/ccsp/queue/status']
  },
  
  // æ“ä½œæ¨©é™
  OPERATOR: {
    permissions: ['queue:control', 'config:update'],
    endpoints: ['/api/ccsp/queue/pause', '/api/ccsp/queue/resume']
  },
  
  // ç®¡ç†è€…æ¨©é™
  ADMIN: {
    permissions: ['emergency:stop', 'config:full', 'system:control'],
    endpoints: ['/api/ccsp/control/emergency-stop']
  }
};
```

---

## ãƒ‡ãƒ¼ã‚¿ä¿è­·

### 1. æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®åˆ†é¡

| ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ— | åˆ†é¡ | ä¿è­·ãƒ¬ãƒ™ãƒ« | æš—å·åŒ– |
|-------------|------|-----------|--------|
| **GitHub Token** | Secret | Critical | Required |
| **Redis Password** | Secret | Critical | Required |
| **APIã‚­ãƒ¼** | Secret | Critical | Required |
| **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹** | Confidential | High | Recommended |
| **å®Ÿè¡Œçµæœ** | Confidential | High | Recommended |
| **ä½¿ç”¨é‡çµ±è¨ˆ** | Internal | Medium | Optional |
| **ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿** | Internal | Medium | Optional |

### 2. ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–

#### ä¿å­˜æ™‚æš—å·åŒ–
```javascript
const crypto = require('crypto');

class SecureStorage {
  constructor(encryptionKey) {
    this.algorithm = 'aes-256-gcm';
    this.key = crypto.scryptSync(encryptionKey, 'salt', 32);
  }
  
  encrypt(data) {
    const iv = crypto.randomBytes(16);
    const cipher = crypto.createCipher(this.algorithm, this.key, iv);
    
    let encrypted = cipher.update(JSON.stringify(data), 'utf8', 'hex');
    encrypted += cipher.final('hex');
    
    const authTag = cipher.getAuthTag();
    
    return {
      encrypted,
      iv: iv.toString('hex'),
      authTag: authTag.toString('hex')
    };
  }
  
  decrypt(encryptedData) {
    const decipher = crypto.createDecipher(
      this.algorithm, 
      this.key, 
      Buffer.from(encryptedData.iv, 'hex')
    );
    
    decipher.setAuthTag(Buffer.from(encryptedData.authTag, 'hex'));
    
    let decrypted = decipher.update(encryptedData.encrypted, 'hex', 'utf8');
    decrypted += decipher.final('utf8');
    
    return JSON.parse(decrypted);
  }
}
```

#### ãƒ­ã‚°ãƒã‚¹ã‚­ãƒ³ã‚°
```javascript
class SecureLogger {
  static SENSITIVE_PATTERNS = [
    /token["\s]*[:=]["\s]*([a-zA-Z0-9_-]+)/gi,
    /password["\s]*[:=]["\s]*([a-zA-Z0-9_!@#$%^&*()-]+)/gi,
    /api[_-]?key["\s]*[:=]["\s]*([a-zA-Z0-9_-]+)/gi,
    /github[_-]?token["\s]*[:=]["\s]*([a-zA-Z0-9_-]+)/gi
  ];
  
  static maskSensitiveData(message) {
    let masked = message;
    
    for (const pattern of this.SENSITIVE_PATTERNS) {
      masked = masked.replace(pattern, (match, sensitive) => {
        const visible = sensitive.substring(0, 4);
        const masked = '*'.repeat(Math.max(sensitive.length - 4, 0));
        return match.replace(sensitive, visible + masked);
      });
    }
    
    return masked;
  }
}
```

---

## é€šä¿¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. é€šä¿¡çµŒè·¯ã®ä¿è­·

#### å¤–éƒ¨é€šä¿¡
```mermaid
sequenceDiagram
    participant CCSP as CCSP Agent
    participant GitHub as GitHub API
    participant Claude as Claude Code CLI
    
    Note over CCSP,GitHub: HTTPS + Token Auth
    CCSP->>GitHub: API Request (HTTPS)
    GitHub-->>CCSP: Response (HTTPS)
    
    Note over CCSP,Claude: Local Process + Validation
    CCSP->>Claude: CLI Execution
    Claude-->>CCSP: Output (Validated)
```

#### å†…éƒ¨é€šä¿¡
```mermaid
sequenceDiagram
    participant Agent as Agent
    participant CCSP as CCSP
    participant Redis as Redis
    
    Note over Agent,CCSP: Redis Pub/Sub + Auth
    Agent->>Redis: Message (AUTH)
    Redis->>CCSP: Deliver (AUTH)
    
    Note over CCSP,Redis: Authenticated Connection
    CCSP->>Redis: Store Data (AUTH)
    Redis-->>CCSP: Confirmation
```

### 2. TLSè¨­å®š

#### HTTPSè¨­å®šï¼ˆæœ¬æ ¼é‹ç”¨æ™‚ï¼‰
```javascript
const https = require('https');
const fs = require('fs');

const tlsOptions = {
  key: fs.readFileSync(process.env.TLS_KEY_PATH),
  cert: fs.readFileSync(process.env.TLS_CERT_PATH),
  ca: fs.readFileSync(process.env.TLS_CA_PATH), // ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
  minVersion: 'TLSv1.2',
  ciphers: 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384',
  honorCipherOrder: true
};

const server = https.createServer(tlsOptions, app);
```

---

## ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### 1. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¿è­·

```javascript
class EndpointSecurity {
  static ENDPOINT_PERMISSIONS = {
    // å…¬é–‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    'GET /api/ccsp/health': { auth: false, level: 'public' },
    
    // èª­ã¿å–ã‚Šå°‚ç”¨
    'GET /api/ccsp/queue/status': { auth: true, level: 'read' },
    'GET /api/ccsp/stats/*': { auth: true, level: 'read' },
    
    // æ“ä½œæ¨©é™
    'POST /api/ccsp/queue/pause': { auth: true, level: 'operator' },
    'POST /api/ccsp/queue/resume': { auth: true, level: 'operator' },
    
    // ç®¡ç†è€…æ¨©é™
    'POST /api/ccsp/control/emergency-stop': { auth: true, level: 'admin' },
    'POST /api/ccsp/config/update': { auth: true, level: 'admin' }
  };
  
  static authorize(req, requiredLevel) {
    const userLevel = this.getUserLevel(req);
    const levelHierarchy = ['public', 'read', 'operator', 'admin'];
    
    const userIndex = levelHierarchy.indexOf(userLevel);
    const requiredIndex = levelHierarchy.indexOf(requiredLevel);
    
    return userIndex >= requiredIndex;
  }
}
```

### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ä¿è­·

```javascript
class SecurityRateLimit {
  constructor() {
    this.attempts = new Map(); // IP/User -> attempts
    this.blacklist = new Set(); // Blocked IPs
  }
  
  checkRateLimit(identifier, endpoint) {
    const key = `${identifier}:${endpoint}`;
    const now = Date.now();
    const window = 60000; // 1åˆ†
    const maxAttempts = this.getMaxAttempts(endpoint);
    
    // ç¾åœ¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã®è©¦è¡Œå›æ•°ã‚’å–å¾—
    const attempts = this.attempts.get(key) || [];
    const windowAttempts = attempts.filter(time => now - time < window);
    
    if (windowAttempts.length >= maxAttempts) {
      // ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã«è¿½åŠ ï¼ˆé‡è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å ´åˆï¼‰
      if (this.isCriticalEndpoint(endpoint)) {
        this.blacklist.add(identifier);
      }
      
      return {
        allowed: false,
        retryAfter: window - (now - windowAttempts[0])
      };
    }
    
    // è©¦è¡Œã‚’è¨˜éŒ²
    windowAttempts.push(now);
    this.attempts.set(key, windowAttempts);
    
    return { allowed: true };
  }
  
  getMaxAttempts(endpoint) {
    const limits = {
      '/api/ccsp/control/emergency-stop': 3,
      '/api/ccsp/queue/pause': 10,
      'default': 60
    };
    
    return limits[endpoint] || limits.default;
  }
}
```

---

## ç›£æŸ»ãƒ»ãƒ­ã‚°

### 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°

```javascript
class SecurityLogger {
  static logSecurityEvent(event) {
    const logEntry = {
      timestamp: new Date().toISOString(),
      eventType: event.type,
      source: event.source,
      user: event.user,
      endpoint: event.endpoint,
      success: event.success,
      reason: event.reason,
      metadata: event.metadata
    };
    
    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚ç”¨ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
    this.writeToSecurityLog(logEntry);
    
    // é‡è¦åº¦ã«å¿œã˜ã¦ã‚¢ãƒ©ãƒ¼ãƒˆ
    if (event.severity === 'critical') {
      this.sendSecurityAlert(logEntry);
    }
  }
  
  static auditAccessAttempt(req, result) {
    this.logSecurityEvent({
      type: 'access_attempt',
      source: req.ip,
      user: req.user?.id,
      endpoint: `${req.method} ${req.path}`,
      success: result.success,
      reason: result.reason,
      severity: result.success ? 'info' : 'warning'
    });
  }
}
```

### 2. ç›£æŸ»ãƒ‡ãƒ¼ã‚¿ã®ä¿è­·

```javascript
class AuditProtection {
  static readonly = true; // ç›£æŸ»ãƒ­ã‚°ã¯èª­ã¿å–ã‚Šå°‚ç”¨
  
  static integrityCheck(logFile) {
    // ãƒãƒƒã‚·ãƒ¥ãƒã‚§ãƒ¼ãƒ³ã«ã‚ˆã‚‹æ”¹ã–ã‚“æ¤œå‡º
    const logs = this.readLogFile(logFile);
    let expectedHash = '';
    
    for (const log of logs) {
      const currentHash = crypto
        .createHash('sha256')
        .update(expectedHash + JSON.stringify(log))
        .digest('hex');
      
      if (log.hash && log.hash !== currentHash) {
        throw new Error(`Log integrity violation at ${log.timestamp}`);
      }
      
      expectedHash = currentHash;
    }
    
    return true;
  }
}
```

---

## ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

### 1. ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆåˆ†é¡

| ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚¿ã‚¤ãƒ— | é‡è¦åº¦ | å¯¾å¿œæ™‚é–“ | ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
|------------------|--------|----------|-----------------|
| **ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹** | Critical | å³åº§ | CISO + é–‹ç™ºãƒãƒ¼ãƒ  |
| **ãƒ‡ãƒ¼ã‚¿æ¼æ´©ç–‘ã„** | Critical | 30åˆ†ä»¥å†… | æ³•å‹™ + CISO |
| **ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢** | High | 1æ™‚é–“ä»¥å†… | é‹ç”¨ãƒãƒ¼ãƒ  |
| **æ¨©é™æ˜‡æ ¼** | High | 2æ™‚é–“ä»¥å†… | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ  |
| **ç•°å¸¸ãªAPIä½¿ç”¨** | Medium | 4æ™‚é–“ä»¥å†… | é–‹ç™ºãƒãƒ¼ãƒ  |

### 2. è‡ªå‹•å¯¾å¿œãƒ•ãƒ­ãƒ¼

```javascript
class IncidentResponse {
  static async handleSecurityIncident(incident) {
    // 1. ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®åˆ†é¡
    const classification = this.classifyIncident(incident);
    
    // 2. è‡ªå‹•çš„ãªåˆæœŸå¯¾å¿œ
    switch (classification.type) {
      case 'unauthorized_access':
        await this.blockSuspiciousIP(incident.source);
        await this.rotateTokens();
        break;
        
      case 'rate_limit_abuse':
        await this.enhanceRateLimit(incident.source);
        break;
        
      case 'data_exfiltration':
        await this.emergencyShutdown();
        await this.alertSecurityTeam(incident);
        break;
    }
    
    // 3. è¨¼è·¡ä¿å…¨
    await this.preserveEvidence(incident);
    
    // 4. é€šçŸ¥ãƒ»ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    await this.notifyStakeholders(classification);
  }
  
  static async emergencyShutdown() {
    // ç·Šæ€¥åœæ­¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«
    await this.stopAllProcessing();
    await this.secureCredentials();
    await this.createForensicSnapshot();
  }
}
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. é–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### æ©Ÿå¯†æƒ…å ±ã®å–ã‚Šæ‰±ã„
```javascript
// âŒ æ‚ªã„ä¾‹
console.log('GitHub token:', process.env.GITHUB_TOKEN);
const config = { token: 'ghp_xxxxxxxxxxxx' };

// âœ… è‰¯ã„ä¾‹
console.log('GitHub token configured:', !!process.env.GITHUB_TOKEN);
const config = { token: process.env.GITHUB_TOKEN };
```

#### å…¥åŠ›å€¤æ¤œè¨¼
```javascript
// âœ… å…¥åŠ›å€¤ã®æ¤œè¨¼
function validateApiRequest(req) {
  const schema = {
    prompt: { type: 'string', maxLength: 10000 },
    priority: { type: 'string', enum: ['urgent', 'high', 'normal', 'low'] },
    timeout: { type: 'number', min: 1000, max: 3600000 }
  };
  
  return joi.validate(req.body, schema);
}
```

### 2. é‹ç”¨è€…å‘ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
```bash
#!/bin/bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

echo "=== CCSPã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ ==="

# 1. èªè¨¼æƒ…å ±ã®ç¢ºèª
if [ -z "$GITHUB_TOKEN" ]; then
  echo "âŒ GITHUB_TOKEN ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"
fi

# 2. Redisèªè¨¼ã®ç¢ºèª
redis-cli --no-auth-warning auth "$REDIS_PASSWORD" ping || echo "âŒ Redisèªè¨¼å¤±æ•—"

# 3. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ç¢ºèª
find logs/ -type f ! -perm 600 -exec echo "âŒ ä¸é©åˆ‡ãªãƒ­ã‚°æ¨©é™: {}" \;

# 4. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ç¢ºèª
find config/ -type f ! -perm 600 -exec echo "âŒ ä¸é©åˆ‡ãªè¨­å®šæ¨©é™: {}" \;

echo "âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Œäº†"
```

#### ãƒˆãƒ¼ã‚¯ãƒ³ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
```bash
#!/bin/bash
# ãƒˆãƒ¼ã‚¯ãƒ³ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

# 1. æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆï¼ˆæ‰‹å‹•ã§ GitHub ã§å®Ÿè¡Œï¼‰
echo "æ–°ã—ã„GitHubãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„"
read -s NEW_TOKEN

# 2. è¨­å®šã®æ›´æ–°
export GITHUB_TOKEN_NEW="$NEW_TOKEN"

# 3. CCSPã®å†èµ·å‹•
systemctl restart ccsp-agent

# 4. å‹•ä½œç¢ºèª
curl -H "Authorization: token $NEW_TOKEN" \
  https://api.github.com/user

# 5. å¤ã„ãƒˆãƒ¼ã‚¯ãƒ³ã®ç„¡åŠ¹åŒ–
echo "GitHubã§å¤ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦ãã ã•ã„"
```

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### åˆæœŸè¨­å®š
- [ ] ã™ã¹ã¦ã®èªè¨¼æƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´
- [ ] ä¸è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç„¡åŠ¹åŒ–
- [ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™è¨­å®šï¼ˆ600ï¼‰
- [ ] Redisèªè¨¼ã®æœ‰åŠ¹åŒ–

#### å®šæœŸãƒã‚§ãƒƒã‚¯
- [ ] èªè¨¼ãƒ­ã‚°ã®ç¢ºèª
- [ ] ç•°å¸¸ãªAPIä½¿ç”¨é‡ã®ç›£è¦–
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æ
- [ ] è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã®å®Ÿè¡Œ

#### ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæº–å‚™
- [ ] ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †æ›¸ã®æº–å‚™
- [ ] ç·Šæ€¥é€£çµ¡å…ˆã®æ•´å‚™
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§æ‰‹é †ã®ç¢ºèª
- [ ] ãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯ç”¨ãƒ„ãƒ¼ãƒ«ã®æº–å‚™
- [ ] æ³•çš„å¯¾å¿œã®æº–å‚™

---

## ã¾ã¨ã‚

CCSPã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ã¯ä»¥ä¸‹ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

### âœ… åŒ…æ‹¬çš„ãªä¿è­·
- å¤šå±¤é˜²å¾¡ã«ã‚ˆã‚‹å …ç‰¢ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®é©åˆ‡ãªæš—å·åŒ–
- é€šä¿¡çµŒè·¯ã®ä¿è­·

### âœ… å®Ÿç”¨çš„ãªé‹ç”¨
- è‡ªå‹•åŒ–ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½
- é‹ç”¨ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
- æ˜ç¢ºãªã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †

### âœ… ç¶™ç¶šçš„ãªæ”¹å–„
- å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼
- è„…å¨ç’°å¢ƒã®å¤‰åŒ–ã¸ã®å¯¾å¿œ
- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®æ›´æ–°

ã“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚Šã€CCSPã¯ä¼æ¥­ç’°å¢ƒã§ã®å®‰å…¨ãªé‹ç”¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**æœ€çµ‚æ›´æ–°**: 2025å¹´6æœˆ21æ—¥  
**é–¢é€£æ–‡æ›¸**: [CCSPã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](./ccsp-architecture.md), [CCSPé‹ç”¨ã‚¬ã‚¤ãƒ‰](./ccsp-operational-guide.md)