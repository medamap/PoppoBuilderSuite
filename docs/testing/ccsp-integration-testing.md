# CCSPçµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰

Issue #144: CCSPç§»è¡Œã®çµ±åˆãƒ†ã‚¹ãƒˆã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»ã®å®Ÿè£…å®Œäº†

## ğŸ“‹ æ¦‚è¦

PoppoBuilder Suiteã«ãŠã‘ã‚‹CCSPï¼ˆClaude Code Spawnerï¼‰ç§»è¡Œã®æˆåŠŸã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆãŒå®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚ã“ã®æ–‡æ›¸ã§ã¯ã€å®Ÿè£…ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨å„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ—ï¸ ãƒ†ã‚¹ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ§‹æˆ

```
test/ccsp/
â”œâ”€â”€ framework/               # å…±é€šãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
â”‚   â”œâ”€â”€ test-framework.js   # ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
â”‚   â””â”€â”€ mocks/              # ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹
â”‚       â”œâ”€â”€ mock-claude-cli.js    # Claude CLI ãƒ¢ãƒƒã‚¯
â”‚       â”œâ”€â”€ mock-redis.js         # Redis ãƒ¢ãƒƒã‚¯
â”‚       â””â”€â”€ mock-github-api.js    # GitHub API ãƒ¢ãƒƒã‚¯
â”œâ”€â”€ validation/             # ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ rate-limit-simulation.js # ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit-tests.js            # å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ integration-tests.js     # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ e2e-scenarios.js         # E2Eã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ run-all-tests.js        # çµ±åˆãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼
â””â”€â”€ reports/               # ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆè©³ç´°

### 1. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `test/ccsp/validation/rate-limit-simulation.js`

**ç›®çš„**: CCSPç§»è¡Œã«ã‚ˆã‚Šã€Claude APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- CCSP Rate Limit Detection - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æ¤œå‡º
- Emergency Stop on Rate Limit - ç·Šæ€¥åœæ­¢æ©Ÿèƒ½
- Multiple Clients Rate Limit Handling - è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã®åˆ¶é™å‡¦ç†
- Rate Limit Recovery - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‹ã‚‰ã®å›å¾©
- Queue Processing During Rate Limit - åˆ¶é™ä¸­ã®ã‚­ãƒ¥ãƒ¼å‡¦ç†

### 2. å˜ä½“ãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `test/ccsp/validation/unit-tests.js`

**ç›®çš„**: CCSPã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å€‹åˆ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- Claude Executor - åŸºæœ¬ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
- Claude Executor - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- Claude Executor - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ¤œå‡º
- Queue Processor - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°
- Queue Processor - å„ªå…ˆåº¦å‡¦ç†
- Queue Processor - ç·Šæ€¥åœæ­¢
- Session Monitor - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- Session Monitor - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå›å¾©
- CCSP Agent - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆ
- CCSP Agent - è¨­å®šç®¡ç†

### 3. çµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `test/ccsp/validation/integration-tests.js`

**ç›®çš„**: PoppoBuilder â†’ CCSP ãƒ•ãƒ­ãƒ¼ã®çµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- PoppoBuilder to CCSP Communication - åŸºæœ¬é€šä¿¡
- Multi-Agent CCSP Usage - ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½¿ç”¨
- Error Handling and Recovery - ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨å›å¾©
- Concurrent Request Processing - ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
- Request Timeout and Retry Logic - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ãƒªãƒˆãƒ©ã‚¤
- Performance and Throughput - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
- Data Integrity and Message Format - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
- CCSP Agent Lifecycle Management - ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

### 4. ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `test/ccsp/validation/e2e-scenarios.js`

**ç›®çš„**: å®Ÿéš›ã®ä½¿ç”¨ã‚·ãƒŠãƒªã‚ªã‚’æ¨¡æ“¬ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- GitHub Issue Processing Workflow - Issueå‡¦ç†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- Multi-Agent Collaboration Scenario - ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå”èª¿
- Error Recovery and Resilience - ã‚¨ãƒ©ãƒ¼å›å¾©ã¨ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹
- High Load Production Simulation - é«˜è² è·æœ¬ç•ªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- Session Management and Recovery - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨å›å¾©
- Resource Exhaustion and Throttling - ãƒªã‚½ãƒ¼ã‚¹æ¯æ¸‡ã¨ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°
- Long-Running Complex Task Processing - é•·æ™‚é–“è¤‡é›‘ã‚¿ã‚¹ã‚¯å‡¦ç†
- Disaster Recovery and State Persistence - ç½å®³å¾©æ—§ã¨çŠ¶æ…‹æ°¸ç¶šåŒ–

## ğŸƒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œ
npm run test:ccsp

# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
node test/ccsp/run-all-tests.js
```

### å€‹åˆ¥ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®Ÿè¡Œ

```bash
# å˜ä½“ãƒ†ã‚¹ãƒˆã®ã¿
npm run test:ccsp:unit

# çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿
npm run test:ccsp:integration

# E2Eãƒ†ã‚¹ãƒˆã®ã¿
npm run test:ccsp:e2e

# ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆã®ã¿
npm run test:ccsp:rate-limit
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãå®Ÿè¡Œ

```bash
# ç‰¹å®šã®ã‚¹ã‚¤ãƒ¼ãƒˆã®ã¿å®Ÿè¡Œ
node test/ccsp/run-all-tests.js --suite "Unit Tests"

# ä¸€éƒ¨ã‚’ã‚¹ã‚­ãƒƒãƒ—
node test/ccsp/run-all-tests.js --skip "e2e,integration"

# æœ€åˆã®ã‚¨ãƒ©ãƒ¼ã§åœæ­¢
node test/ccsp/run-all-tests.js --bail

# ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’ç„¡åŠ¹åŒ–
node test/ccsp/run-all-tests.js --no-report

# ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
node test/ccsp/run-all-tests.js --help
```

## ğŸ“Š ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹

### Mock Claude CLI

**æ©Ÿèƒ½**:
- å®Ÿéš›ã®Claude APIã‚’å‘¼ã³å‡ºã•ãšã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¨­å®š
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆå±¥æ­´ã®è¨˜éŒ²

**ä½¿ç”¨ä¾‹**:
```javascript
const mockClaude = mockServices.get('claude');
mockClaude.setResponse('rateLimitError', {
  code: 1,
  stdout: 'Claude AI usage limit reached|' + unlockTime,
  stderr: 'Rate limit exceeded'
});
```

### Mock Redis

**æ©Ÿèƒ½**:
- ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªRedisæ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…
- å…¨Rediså‘½ä»¤ã®ã‚µãƒãƒ¼ãƒˆï¼ˆSET/GET/LPUSH/RPOPç­‰ï¼‰
- ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã¨ã‚¨ãƒ©ãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- çµ±è¨ˆæƒ…å ±ã®åé›†

**ä½¿ç”¨ä¾‹**:
```javascript
const redis = mockServices.get('redis');
await redis.lpush('ccsp:requests', JSON.stringify(request));
const response = await redis.blpop('ccsp:response:agent', 1);
```

### Mock GitHub API

**æ©Ÿèƒ½**:
- GitHub APIå‘¼ã³å‡ºã—ã®å®Œå…¨ãƒ¢ãƒƒã‚¯
- Issueã€ã‚³ãƒ¡ãƒ³ãƒˆã€ãƒ©ãƒ™ãƒ«æ“ä½œ
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®äº‹å‰è¨­å®š

**ä½¿ç”¨ä¾‹**:
```javascript
const mockGitHub = mockServices.get('github');
const issue = await mockGitHub.getIssue(144);
await mockGitHub.createIssueComment(144, 'ãƒ†ã‚¹ãƒˆã‚³ãƒ¡ãƒ³ãƒˆ');
```

## ğŸ“ˆ ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ

### ç”Ÿæˆã•ã‚Œã‚‹ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼

1. **JSONå½¢å¼** (`ccsp-test-results.json`)
   - æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆçµæœãƒ‡ãƒ¼ã‚¿
   - è‡ªå‹•å‡¦ç†ã‚„CI/CDçµ±åˆç”¨

2. **HTMLå½¢å¼** (`ccsp-test-results.html`)
   - ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãªãƒ¬ãƒãƒ¼ãƒˆ
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§è¡¨ç¤ºå¯èƒ½

3. **Markdownå½¢å¼** (`ccsp-test-results.md`)
   - GitHubç­‰ã§ã®è¡¨ç¤ºç”¨
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆçµ±åˆå¯èƒ½

### ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹

- **å®Ÿè¡Œã‚µãƒãƒªãƒ¼**: ç·ãƒ†ã‚¹ãƒˆæ•°ã€æˆåŠŸ/å¤±æ•—æ•°ã€å®Ÿè¡Œæ™‚é–“
- **ã‚¹ã‚¤ãƒ¼ãƒˆåˆ¥è©³ç´°**: å„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®çµæœ
- **ã‚¨ãƒ©ãƒ¼è©³ç´°**: å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ã‚¨ãƒ©ãƒ¼æƒ…å ±
- **ç’°å¢ƒæƒ…å ±**: Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ç­‰

## ğŸ¯ å“è³ªä¿è¨¼æŒ‡æ¨™

### æˆåŠŸåŸºæº–

- **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 95%ä»¥ä¸Š
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: å¹³å‡30ç§’ä»¥å†…
- **ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ**: 100 requests/minä»¥ä¸Š
- **ã‚¨ãƒ©ãƒ¼å›å¾©**: 10ç§’ä»¥å†…
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: 500MBä»¥å†…

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

- **ä¸¦è¡Œå‡¦ç†**: æœ€å¤§10ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- **ã‚­ãƒ¥ãƒ¼å‡¦ç†**: FIFOé †åºä¿è¨¼
- **çŠ¶æ…‹æ°¸ç¶šåŒ–**: 100%ãƒ‡ãƒ¼ã‚¿ä¿æŒ
- **ç½å®³å¾©æ—§**: å®Œå…¨ãªçŠ¶æ…‹å¾©å…ƒ

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ä¸€èˆ¬çš„ãªå•é¡Œã¨è§£æ±ºæ–¹æ³•

1. **ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**
   ```bash
   # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·
   CCSP_TEST_TIMEOUT=120000 npm run test:ccsp
   ```

2. **Redisæ¥ç¶šã‚¨ãƒ©ãƒ¼**
   ```bash
   # Redisè¨­å®šã‚’ç¢ºèª
   echo "Redisè¨­å®šã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„"
   ```

3. **ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–å¤±æ•—**
   ```bash
   # æ¨©é™ã‚’ç¢ºèª
   ls -la test/ccsp/framework/mocks/
   ```

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

```bash
# ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æœ‰åŠ¹åŒ–
DEBUG=ccsp:* npm run test:ccsp

# è©³ç´°ãƒ­ã‚°å‡ºåŠ›
CCSP_TEST_VERBOSE=true npm run test:ccsp
```

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Issue #144](https://github.com/medamap/PoppoBuilderSuite/issues/144) - CCSPç§»è¡Œã®çµ±åˆãƒ†ã‚¹ãƒˆã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»
- [CCSPã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](../architecture/ccsp-overview.md)
- [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµ±åˆã‚¬ã‚¤ãƒ‰](../features/agent-integration.md)
- [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](./test-strategy.md)

## ğŸ‰ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ±åˆ
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: æœ¬ç•ªç’°å¢ƒã§ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
3. **ãƒ†ã‚¹ãƒˆæ‹¡å¼µ**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: ãƒ†ã‚¹ãƒˆçµæœã«åŸºã¥ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ”¹å–„

---

**å®Ÿè£…å®Œäº†æ—¥**: 2025/6/21  
**å¯¾å¿œIssue**: [#144](https://github.com/medamap/PoppoBuilderSuite/issues/144)  
**å®Ÿè£…è€…**: Claude Code  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼çŠ¶æ…‹**: å®Ÿè£…å®Œäº†ã€ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†