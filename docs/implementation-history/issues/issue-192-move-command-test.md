# Issue #192: poppobuilder moveコマンドのテスト実装

## 概要
新しく実装された `poppobuilder move` コマンドの動作を確認するための包括的なテストスイートを実装しました。

## 実装内容

### 1. 単体テスト（`test/poppobuilder-move.test.js`）

#### 基本的な移動操作
- 同一デバイス内での移動テスト
- 設定ファイルのパス更新確認
- レジストリの更新確認

#### シンボリックリンクオプション
- `--symlink` オプションでのシンボリックリンク作成
- シンボリックリンク作成失敗時のグレースフルハンドリング
- シンボリックリンク経由でのアクセス確認

#### Git統合
- 未コミット変更の検出とユーザープロンプト
- `--force` オプションでのプロンプトスキップ
- Git状態チェックの動作確認

#### 親ディレクトリ作成
- 存在しない親ディレクトリへの移動エラー
- `--parents` オプションでの自動作成
- ディレクトリ構造の検証

#### エラーケース
- プロジェクトが見つからない場合
- ソースと宛先が同じ場合
- 移動先が既に存在する場合
- 移動先にPoppoBuilderプロジェクトが存在する場合
- 実行中タスクがある場合の移動拒否

#### クロスデバイス移動
- EXDEVエラーのハンドリング
- コピー＆削除による移動の実装
- クロスデバイス移動の通知

#### ロールバック機能
- 移動失敗時の自動ロールバック
- ロールバック成功/失敗の通知

#### プロジェクト提案
- 類似プロジェクト名の提案機能

### 2. 統合テスト（`test/integration/move-command-integration.test.js`）

#### 実ファイルシステム操作
- 完全なプロジェクト構造の移動
- ネストされたディレクトリ構造の保持
- ファイル内容の完全性確認

#### Gitリポジトリ処理
- Gitリポジトリの移動
- Git操作の継続性確認
- `.git` ディレクトリの適切な処理

#### シンボリックリンク機能
- 実際のシンボリックリンク作成
- シンボリックリンク経由のアクセステスト
- プラットフォーム別の対応

#### 権限とアクセステスト
- ファイル権限の保持（Unix系）
- 実行可能ビットの保持
- プラットフォーム固有の処理

#### 大規模ファイル処理
- 10MBファイルの移動テスト
- パフォーマンスの検証
- データ整合性の確認

#### エラーリカバリー
- 移動中断のシミュレーション
- 部分的な移動からの回復
- 状態の一貫性維持

### 3. ドキュメント（`docs/commands/move-command.md`）

- コマンドの詳細な使用方法
- すべてのオプションの説明
- 実用的な使用例
- エラーハンドリングガイド
- トラブルシューティング

## テストカバレッジ

### カバーされているシナリオ
- ✅ 基本的な移動操作（6テスト）
- ✅ シンボリックリンク機能（2テスト）
- ✅ Git統合（2テスト）
- ✅ 親ディレクトリ作成（2テスト）
- ✅ エラーケース（5テスト）
- ✅ クロスデバイス移動（1テスト）
- ✅ ロールバック機能（1テスト）
- ✅ プロジェクト提案（1テスト）
- ✅ 統合テスト（6シナリオ）

合計：26個のテストケース

## 技術的詳細

### モックとスタブ
- Sinonを使用した包括的なモック
- ファイルシステム操作のスタブ
- プロンプトのモック
- コンソール出力のスパイ

### テスト環境
- 一時ディレクトリの自動作成/削除
- 各テストの独立性保証
- クロスプラットフォーム対応

### パフォーマンス
- タイムアウト設定による長時間操作の考慮
- 大規模ファイルテストの最適化

## 実行方法

```bash
# 単体テストのみ
npm test test/poppobuilder-move.test.js

# 統合テストのみ
npm test test/integration/move-command-integration.test.js

# すべてのmoveコマンドテスト
npm test -- --grep "move"

# カバレッジレポート付き
npm run test:coverage -- test/poppobuilder-move.test.js
```

## 今後の拡張可能性

1. **並列移動のテスト**
   - 複数プロジェクトの同時移動
   - リソース競合の処理

2. **ネットワークドライブ対応**
   - リモートファイルシステムへの移動
   - レイテンシの考慮

3. **進捗表示のテスト**
   - 大規模プロジェクトの進捗バー
   - 中断/再開機能

4. **自動バックアップ**
   - 移動前の自動バックアップ作成
   - バックアップからの復元テスト

## 関連ファイル
- `lib/commands/move.js` - moveコマンドの実装
- `test/poppobuilder-move.test.js` - 単体テスト
- `test/integration/move-command-integration.test.js` - 統合テスト
- `docs/commands/move-command.md` - ユーザードキュメント