# PoppoBuilder Suite 実装計画

## 概要

この文書では、PoppoBuilder Suiteの段階的な実装アプローチを概説し、迅速なMVP提供とセルフホスティング機能に焦点を当てます。

## フェーズ1: 最小実行可能製品（第1週）

### 目標
- 基本的なタスク実行機能
- シンプルな状態管理
- 手動テストワークフロー

### 成果物

#### 1.1 基本的なCICDスケジューラー
```
cicd/
├── scheduler.js        # メインスケジューラーループ
├── job-manager.js      # ジョブライフサイクル管理
└── process-spawn.js    # Claudeサブプロセス処理
```

主な機能:
- 30秒ごとにPoppoリポジトリをポーリング
- タスク用のClaudeサブプロセスを起動
- プロセス状態を追跡
- 基本的なエラー処理

#### 1.2 最小限のPoppoリポジトリ
```
poppo-repo/
├── config.json         # システム設定
├── tasks/              # タスクキュー
├── status/             # ジョブ状態追跡
└── results/            # ジョブ出力
```

#### 1.3 シンプルなCCPM実装
- タスクリクエストの読み取り
- 基本的な指示書の生成
- タスクキューの更新

#### 1.4 シンプルなCCAG実装
- 実装タスクの実行
- ファイル作成
- 基本的なエラー報告

### 成功基準
- MCPを介してタスクを送信できる
- タスクがCCAGによって実行される
- 結果が取得できる

## フェーズ2: セルフホスティングブートストラップ（第2週）

### 目標
- PoppoBuilderが自身のコードベースで動作
- GitHub連携
- 基本的なPRワークフロー

### 成果物

#### 2.1 CCGM実装
- プロジェクト初期化
- 設定管理
- ステータスレポート
- タスクからのIssue作成

#### 2.2 拡張CCAG
- Git操作（ブランチ、コミット、プッシュ）
- PR作成
- 自己修正機能

#### 2.3 タスク依存関係システム
- タスク順序付け
- 依存関係解決
- 可能な限り並列実行

### 成功基準
- PoppoBuilderが自身に機能を追加できる
- PRが自動的に作成される
- 基本的な開発ループが確立される

## フェーズ3: 完全自動化（第3-4週）

### 目標
- 完全なエージェントアンサンブル
- 自動レビューとマージ
- 本番環境対応システム

### 成果物

#### 3.1 CCRA（レビューエージェント）
- PRレビュー機能
- コード品質チェック
- フィードバック生成

#### 3.2 CCTA（テストエージェント）
- テスト実行
- カバレッジレポート
- パフォーマンス検証

#### 3.3 CCMA（マージエージェント）
- マージ判定ロジック
- コンフリクト検出
- ブランチ管理

#### 3.4 高度なCICD機能
- リソース管理
- 優先度キューイング
- 障害回復
- パフォーマンス監視

### 成功基準
- 完全に自動化された開発パイプライン
- 自己改善型システム
- 本番環境の安定性

## 実装ガイドライン

### 1. シンプルに始める
- すべてのデータストレージにJSONファイルを使用
- 早すぎる最適化を避ける
- エンドツーエンドのフローに焦点を当てる

### 2. 反復的な開発
- 各コンポーネントは単独で動作すべき
- 自動化前に手動でテスト
- 進めながらドキュメント化

### 3. セルフホスティング優先
- 基本的なCCPM/CCAGが動作したら、すぐに使用
- 残りの機能のIssueを作成
- システムに自身を構築させる

### 4. エラー処理
- 優雅に失敗
- すべてをログに記録
- デバッグを容易に

## 技術的決定

### 言語選択
- **CICDシステム**: Node.js（プロセス管理のため）
- **設定**: JSON（シンプルで汎用的）
- **エージェント通信**: ファイルベース（シンプルでデバッグ可能）

### プロセス管理
```javascript
// サブプロセス起動の例
const { spawn } = require('child_process');

function runAgent(agentType, instruction) {
  const subprocess = spawn('claude', [
    '--dangerously-skip-permissions',
    '--print',
    JSON.stringify(instruction)
  ], {
    cwd: process.cwd(),
    detached: true,
    stdio: ['ignore', 'pipe', 'pipe']
  });
  
  subprocess.unref(); // 親プロセスの終了を許可
  return subprocess.pid;
}
```

### 状態管理
```javascript
// シンプルなファイルベースの状態
const state = {
  jobs: {},
  queue: [],
  
  save() {
    fs.writeFileSync('poppo-repo/status/state.json', 
      JSON.stringify(this, null, 2));
  },
  
  load() {
    Object.assign(this, 
      JSON.parse(fs.readFileSync('poppo-repo/status/state.json')));
  }
};
```

## リスク軽減

### 1. サブプロセス管理
- クリーンアップのためのPID追跡
- タイムアウトメカニズムの実装
- ゾンビプロセスの処理

### 2. 状態の破損
- アトミックなファイル書き込み
- 更新前のバックアップ
- 回復手順

### 3. 無限ループ
- 1日あたりのタスク制限
- 循環依存関係の検出
- 手動オーバーライド機能

## 成功のための指標

### フェーズ1
- 最初のタスク実行時間: 5分未満
- タスク成功率: 80%以上
- システムセットアップ時間: 30分未満

### フェーズ2
- 自己修正成功率: 70%以上
- PR作成成功率: 90%以上
- 自律動作時間: 4時間以上

### フェーズ3
- 完全なパイプライン完了: 1時間未満
- マージ成功率: 85%以上
- システム安定性: 24時間以上の連続動作